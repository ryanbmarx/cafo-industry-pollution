{# Override the `container` block to disable default layout. #}
{% block container %}
{% block content %}
<!-- 
  #############################################
  ### WAIT! DO NOT EDIT HERE!
  ### EDIT IN THE SPREADSHEET!
  #############################################
-->
{% include "_chart_buttons.html" %}

<div id='pig-chart-container'></div>
<div class='row'>
  <div class='six columns'>
    <h2 class='label'>Toggle the choropleth data</h2>
    {% include "_map_buttons.html" %}
    {% include "_map_select.html" %}
    <h2 class='label'>Cycle through pollution events</h2>
    {% include "_profile_buttons.html" %}
  </div>
  <div class='six columns'>
    <div id='legend-container' class='key'></div>
  </div>
</div>
<div class='row'>
  <div class='six columns'>
    <div id="map"></div>
  </div>
  <div class='six columns'>
    <div id="profile-container" class=''>
      <h2>{{ map_intro_header|process_text }}</h2> 
      {{map_intro_text|markdown}}
    </div>
  </div>
</div>
  <section class='credits'>
   <p>{{ sources }}</p>
 </section>
 {% endblock content %}
 {% endblock container %}

 {% block library_scripts %}
 <script src="//code.jquery.com/jquery-2.2.3.min.js"></script>
 <script src="//{{ ROOT_URL }}/js/vendor.min.js"></script>
 {% endblock %}

 {% block scripts %}
 <script src="//{{ ROOT_URL }}/js/app.min.js"></script>
 <script>
  (function(window, document) {
    /*  TODO: Bundle vendor CSS into a single file */
    var CSS = [
    "//s3.amazonaws.com/media.apps.chicagotribune.com/graphics-toolbox/skeleton.css",
    "//{{ ROOT_URL }}/css/leaflet.css",
    "//{{ ROOT_URL }}/css/styles.css"
    ];    
    CSS.forEach(function(url) {
      var link = document.createElement('link');
      link.setAttribute('rel', 'stylesheet');
      link.setAttribute('href', url);
      document.head.appendChild(link);
    });

  /* 
  This little lookup table provides the labels and sublabels for the choropleth data.
  */
  {# TODO: Use custom filter+python to make JSON var #}
  var pigsOverTimeData = [
    {% for row in pigs_over_time %}
    {
        year:{{ row.year }},
        farms:{
          type: "integer",
          big: {{ row.farms_big }},
          rest: {{ row.farms }}
        },
        pigs:{
          type: "integer",
          big: {{ row.pigs_big }},
          rest: {{ row.pigs }}
        },
        value:{
          type: "currency",
          big: {{ row.value_big }},
          rest: {{ row.value }}
        }
        }{% if not loop.last %}, {% endif %}
    {% endfor %}
  ];


  /* 
  This little lookup table provides the labels and sublabels for the choropleth data.
  */

  var dataLabels = {
    {% for row in map_buttons %}
    hogs_data_{{ row.data_att }}: {
      primary: "{{ row.label }}",
      secondary:"{{ row.secondary_label }}",
      type:"{{ row.data_type }}"
    }{% if not loop.last %}, {% endif %}
    {% endfor %}
  };

  window.onload = function(){
    var pigChart = new CafoMap.PigsOverTimeChart ({
      container:document.getElementById('pig-chart-container'),
      data: pigsOverTimeData,
      category: "pigs" // can be "value", "pigs" or "farms"
    });

   var pigChartButtons = new CafoMap.PigChartButtons({
      buttons:document.getElementsByClassName('chart-button'),
      chart:pigChart
   });
   // TRIGGER CLICK EVENT WILL RENDER CHART
  document.querySelector(".chart-button[data-chart='pigs']").click();
  

    /* Build the actual map here */
    var map = new CafoMap.CafoMap({
      mapTargetID:"map",
      dataRootUrl: "//{{ ROOT_URL }}/data/",
      propertyToMap:"hogs_data_FARM_1000",
      legendContainer:document.getElementById('legend-container'),
      dataLabelLookup:dataLabels,
      countyOptions:{
        fillColor:"#FF0000",
      },
      profileOptions: {
        /* Dot styles here */
        strokeWidth:1,
        strokeColor:'black',
        fill:true,
        fillColor: '#000000',
        fillOpacity: .8,
        radius:5,
        label:"One pollution event",
        profileContainer:document.getElementById('profile-container'),
        active:{
          /* Styles on click */
          fillColor: '#ffff00',
          strokeWidth:3
        },
        hover:{
          /* Styles on click */
          fillColor: '#800',
          strokeWidth:1
        }

      }
    });

    /* Build the map buttons here */
    var mapButtons = new CafoMap.CafoMapButtons({
      buttons:document.getElementsByClassName('map-button'),
      map:map
    });
    /* Build the <select> here */
    var mapSelect = new CafoMap.CafoMapSelect({
      menu:document.getElementsByClassName('map-select'),
      map:map
    });

    var profileButtons = new CafoMap.CafoProfileButtons({
      buttons:document.getElementsByClassName('profile-button'),
      map:map
    });

  };

})(window, document);    
</script>
{% endblock scripts %}
