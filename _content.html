{# Override the `container` block to disable default layout. #}
{% block container %}
{% block content %}
<!-- 
  #############################################
  ### WAIT! DO NOT EDIT HERE!
  ### EDIT IN THE SPREADSHEET!
  #############################################

  TODO: Make mixin for button styling

-->
<div class='graphic-wrapper'>
  <span class='pollution-map-intro'>{{ map_intro|markdown }}</span>
  <section class='pollution-map'>
    <div class='row'>
      <div class='six columns'>
        <p class='label'>{{ map_menu_intro_label|process_text }}</p>
        <div class="map_menu_intro">
          {{ map_menu_intro|markdown }}
        </div>
        {% include "_map_select.html" %}
        {% include "_map_legend.html" %}
        <div id="map"></div>
      </div>
      <div class='six columns'>
        <h2 class='label'>{{ pollution_events_label }}</h2>
        {% include "_profile_buttons.html" %}

        <div id="profile-container" class=''>
        </div>
      </div>
    </div>
  </section>
  <section class='credits'>
   <p>{{ sources }}</p>
  </section>
</div>
{% endblock content %}
{% endblock container %}

{% block library_scripts %}
<script src="//code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="//{{ ROOT_URL }}/js/vendor.min.js"></script>
{% endblock %}

{% block scripts %}
<script src="//{{ ROOT_URL }}/js/app.min.js"></script>
<script>
  (function(window, document) {
    var CSS = [
    "//{{ ROOT_URL }}/css/vendor.min.css",
    "//{{ ROOT_URL }}/css/styles.css"
    ];    
    CSS.forEach(function(url) {
      var link = document.createElement('link');
      link.setAttribute('rel', 'stylesheet');
      link.setAttribute('href', url);
      document.head.appendChild(link);
    });

  

  var dataLabels = {
    {% for row in map_buttons %}
    hogs_data_{{ row.data_att }}: {
      primary: "{{ row.label }}",
      secondary:"{{ row.secondary_label }}",
      type:"{{ row.data_type }}"
    }{% if not loop.last %}, {% endif %}
    {% endfor %}
  };

  window.onload = function(){

  /* Build the actual map here */
  var map = new CafoMap.CafoMap({
    mapTargetID:"map",
    dataRootUrl: "//{{ ROOT_URL }}/data/",
    propertyToMap:"hogs_data_FARM_1000",
    legendContainer:document.getElementById('legend-container'),
    dataLabelLookup:dataLabels,
    countyOptions:{
      fillColor:"#FF0000",
    },
    profileOptions: {
      /* Dot styles here */
      strokeWidth:1,
      strokeColor:'black',
      fill:true,
      fillColor: '#000000',
      fillOpacity: .4,
      radius:5,
      label:"One pollution event",
      profileContainer:document.getElementById('profile-container'),
      active:{
        /* Styles on click */
        fillColor: '#ffff00',
        strokeWidth:2,
        fillOpacity: 1
      },
      hover:{
        /* Styles on click */
        fillColor: '#800',
        strokeWidth:1
      }

    }
  });

  /* Build the map buttons here */
  // var mapButtons = new CafoMap.CafoMapButtons({
  //   buttons:document.getElementsByClassName('map-button'),
  //   map:map
  // });
  /* Build the <select> here */
  var mapSelect = new CafoMap.CafoMapSelect({
    menu:document.getElementsByClassName('map-select'),
    map:map
  });

  var profileButtons = new CafoMap.CafoProfileButtons({
    buttons:document.getElementsByClassName('profile-button'),
    map:map
  });

  // var story = new CafoMap.TellMeAStory({
  //   storytellingButton:document.getElementsByClassName('button--story'),
  //   dataButton:document.getElementsByClassName('button--data'),
  //   text:storyText,
  //   chart:'.pigchart',
  //   chartButtons:pigChartButtons,
  //   timeInterval:'5000',
  //   fadedBackground: "rgba(255, 255, 255, .9)",
  //   boxShadow: "3px 3px 5px rgba(0,0,0,.15)"
  // })

};

})(window, document);    
</script>
{% endblock scripts %}
